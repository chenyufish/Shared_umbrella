{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nexport default {\n  name: \"Index\",\n  data() {\n    return {\n      activeIndex: \"1\",\n      carouselGoods: [],\n      activeName: \"all\",\n      goods: [{\n        id: 1,\n        title: \"笃学楼\",\n        gimage: \"https://th.bing.com/th/id/OIP.e50FmnhjA_7V7qco940hoQHaFF?w=1200&h=825&rs=1&pid=ImgDetMain\",\n        gcontent: \"优质材料，经典黑色，耐用防水。\",\n        gcount: 100,\n        glevel: 1\n      }, {\n        id: 2,\n        title: \"经世楼\",\n        gimage: \"https://th.bing.com/th/id/OIP.uGeEptel9JcfpSkyhte7iAHaE8?w=1200&h=800&rs=1&pid=ImgDetMain\",\n        gcontent: \"鲜艳的颜色，适合儿童使用。\",\n        gcount: 50,\n        glevel: 2\n      }, {\n        id: 3,\n        title: \"文理大楼\",\n        gimage: \"https://th.bing.com/th/id/OIP.p_NRM0_x1zsMJDiXlTXtqQHaE8?w=1200&h=800&rs=1&pid=ImgDetMain\",\n        gcontent: \"轻便折叠，随身携带。\",\n        gcount: 200,\n        glevel: 3\n      }],\n      labels: [\"全部\"],\n      names: [\"all\"],\n      currentPage: 1,\n      pageLimits: [10],\n      pageSize: 10,\n      itemTotal: 10,\n      searchName: \"\",\n      loginFlag: false,\n      token: null,\n      currGoods: {},\n      currUser: null,\n      uCount: {}\n    };\n  },\n  methods: {\n    toLogin() {\n      this.$router.push({\n        path: \"/Login\"\n      });\n    },\n    toRegister() {\n      this.$router.push({\n        path: \"/Register\"\n      });\n    },\n    async getGoodsCount(page, limit) {\n      try {\n        const response = await this.axios.get('http://localhost:8123/api/goods/count');\n        const goodsData = response.data; //\n\n        this.goods = goodsData.goods; // 更新 goods 数据\n        this.itemTotal = goodsData.length; // 更新总数量\n        this.carouselGoods = goodsData.slice(0, 3); // 更新轮播图数据\n        this.uCount = goodsData.ulevelCount;\n      } catch (error) {\n        console.error('Failed to fetch goods data:', error);\n        this.$message.error('无法获取商品数据');\n      }\n    },\n    getGoods(page, limit) {\n      // Simulating a backend call with the mock data\n      console.log(\"Fetching goods for page\", page, \"with limit\", limit);\n      // For simplicity, here we are not making an actual axios request\n      // You can implement the logic for fetching data from backend here\n      this.itemTotal = this.goods.length;\n      this.carouselGoods = this.goods.slice(0, 4);\n    },\n    handleSizeChange(limit) {\n      this.limit = limit;\n      this.currentPage = 1;\n      this.getGoods(this.currentPage, this.limit);\n    },\n    handleCurrentChange(val) {\n      this.currentPage = val;\n      this.getGoods(this.currentPage, this.limit);\n    },\n    toCarousel() {},\n    onBuy(res) {\n      console.log(res);\n      if (!this.token) {\n        this.$message({\n          message: \"请先登录\",\n          type: \"error\"\n        });\n      } else {\n        this.currGoods = res;\n        this.$confirm(\"确认租借后将生成订单信息\", \"确认信息\", {\n          distinguishCancelAndClose: true,\n          confirmButtonText: \"确认\",\n          cancelButtonText: \"取消\"\n        }).then(() => {\n          this.buyGoods();\n        }).catch(action => {\n          this.$message({\n            type: \"warning\",\n            message: \"已放弃租借\"\n          });\n        });\n      }\n    },\n    toLoginout() {\n      console.log(this.token, \"<<<<<token\");\n      this.axios.post(\"http://localhost:8123/api/user/loginout\", null, {\n        params: {\n          token: this.token\n        }\n      }).then(resp => {\n        console.log(resp);\n        localStorage.removeItem(\"token\");\n        this.loginFlag = false;\n        this.token = null;\n        this.$message({\n          message: \"退出成功\",\n          type: \"success\"\n        });\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    toHome() {\n      this.$router.push({\n        path: \"/Home\"\n      });\n    },\n    buyGoods() {\n      this.axios.defaults.headers.post[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\n      const params = new URLSearchParams();\n      params.append(\"token\", this.token);\n      params.append(\"dAmount\", this.currGoods.gprice);\n      params.append(\"dCount\", 1);\n      params.append(\"sId\", this.currGoods.uid);\n      params.append(\"gId\", this.currGoods.gid);\n      params.append(\"bId\", this.currUser.uid);\n      this.axios.post(\"http://localhost:8123/api/order/add\", params).then(resp => {\n        console.log(resp);\n        this.getGoods();\n        this.$message({\n          type: \"success\",\n          message: \"订单生成成功，请前往个人中心完成支付  \"\n        });\n        this.currGoods = {};\n      }).catch(error => {\n        console.log(error);\n      });\n      this.currGoods = {};\n    }\n  },\n  created() {\n    this.getGoods(1, 10);\n    let token = localStorage.getItem(\"token\");\n    console.log(token);\n    if (token === null) {\n      this.loginFlag = false;\n      this.token = null;\n      this.currUser = null;\n    } else {\n      this.token = token;\n      this.loginFlag = true;\n      this.currUser = JSON.parse(localStorage.getItem(\"currUser\"));\n    }\n  }\n};","map":{"version":3,"names":["name","data","activeIndex","carouselGoods","activeName","goods","id","title","gimage","gcontent","gcount","glevel","labels","names","currentPage","pageLimits","pageSize","itemTotal","searchName","loginFlag","token","currGoods","currUser","uCount","methods","toLogin","$router","push","path","toRegister","getGoodsCount","page","limit","response","axios","get","goodsData","length","slice","ulevelCount","error","console","$message","getGoods","log","handleSizeChange","handleCurrentChange","val","toCarousel","onBuy","res","message","type","$confirm","distinguishCancelAndClose","confirmButtonText","cancelButtonText","then","buyGoods","catch","action","toLoginout","post","params","resp","localStorage","removeItem","toHome","defaults","headers","URLSearchParams","append","gprice","uid","gid","created","getItem","JSON","parse"],"sources":["src/views/CarouselView.vue"],"sourcesContent":["\n<template>\n  <div class=\"block\">\n    <el-header v-if=\"!loginFlag\" style=\"padding: none; background-color: none\">\n      <el-menu class=\"el-menu-demo\">\n        <el-menu-item style=\"float: left; font-size: large; font-weight: 900\">\n          共享雨伞平台\n        </el-menu-item>\n        <el-menu-item style=\"float: right\">\n          <el-button @click=\"toRegister\">注册</el-button>\n        </el-menu-item>\n        <el-menu-item style=\"float: right\">\n          <el-button @click=\"toLogin\">登录</el-button>\n        </el-menu-item>\n      </el-menu>\n    </el-header>\n    <el-header v-else>\n      <el-menu class=\"el-menu-demo\">\n        <el-menu-item style=\"float: left; font-size: large; font-weight: 900\">\n          共享雨伞平台\n        </el-menu-item>\n        <el-menu-item style=\"float: right\">\n          <el-button @click=\"toLoginout\">退出登录</el-button>\n        </el-menu-item>\n        <el-menu-item style=\"float: right\">\n          <el-button @click=\"toHome\">个人中心</el-button>\n        </el-menu-item>\n      </el-menu>\n    </el-header>\n\n    <el-carousel height=\"500px\">\n      <!-- <el-carousel-item v-for=\"item in carouselGoods\" :key=\"item.gid\">\n        <el-image :src=\"item.gimage\" @click=\"toCarousel\"> </el-image>\n      </el-carousel-item> -->\n      <el-carousel-item style=\"text-align: center;\">\n        <el-image style=\"display: block; margin: 0 auto; width: 100%; height: 100%;\" src=\"https://th.bing.com/th/id/R.793a3d538e650a2189ab6d51bd82fd8f?rik=yQH8tY%2bW4Tzb9w&riu=http%3a%2f%2fwww.gewuer.com%2fPublic%2fuploads%2fimage%2f201612%2f20161219113417_76649.jpg&ehk=bEp1vFDNMTYugfB70E6agz8y%2fgh3UcP2D2St7TsMQa8%3d&risl=&pid=ImgRaw&r=0\">\n        </el-image>\n      </el-carousel-item>\n\n      <el-carousel-item style=\"text-align: center;\">\n        <el-image style=\"display: block; margin: 0 auto; width: 100%; height: 100%;\" src=\"https://th.bing.com/th/id/R.793a3d538e650a2189ab6d51bd82fd8f?rik=yQH8tY%2bW4Tzb9w&riu=http%3a%2f%2fwww.gewuer.com%2fPublic%2fuploads%2fimage%2f201612%2f20161219113417_76649.jpg&ehk=bEp1vFDNMTYugfB70E6agz8y%2fgh3UcP2D2St7TsMQa8%3d&risl=&pid=ImgRaw&r=0\">\n        </el-image>\n      </el-carousel-item>\n    </el-carousel>\n\n    <div style=\"margin: 20px\">\n      <el-row>\n        <el-tabs @tab-click=\"handleClick\" class=\"tab\" v-model=\"activeName\">\n          <el-tab-pane\n              v-for=\"(lab, index) in labels\"\n              :label=\"lab\"\n              :key=\"index\"\n              :name=\"names[index]\"\n          >\n            <!-- 卡片 -->\n            <el-row style=\"margin: 10px\">\n              <el-col v-for=\"item in goods\" :key=\"item.id\" :span=\"8\">\n                <el-card :header=\"item.title\" v-if=\"item.gcount > 0\">\n                  <el-image :src=\"item.gimage\"> </el-image>\n                  <div style=\"padding: 14px\">\n                    <div class=\"bottom clearfix\">\n                      <span\n                          style=\"\n                          display: inline-block;\n                          text-align: left;\n                          width: 100%;\n                        \"\n                      ><b>数量：</b>{{ item.gcount }} 个</span\n                      >\n                      <el-button type=\"text\" class=\"button\" @click=\"onBuy(item)\"\n                      >租借</el-button\n                      >\n                    </div>\n                  </div>\n                </el-card>\n              </el-col>\n            </el-row>\n          </el-tab-pane>\n        </el-tabs>\n      </el-row>\n    </div>\n    <el-pagination\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"currentPage\"\n        :page-sizes=\"pageLimits\"\n        :page-size=\"pageSize\"\n        layout=\"total, sizes, prev, pager, next, jumper\"\n        :total=\"itemTotal\"\n    >\n    </el-pagination>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"Index\",\n  data() {\n    return {\n      activeIndex: \"1\",\n      carouselGoods: [],\n      activeName: \"all\",\n      goods: [\n        {\n          id: 1,\n          title: \"笃学楼\",\n          gimage: \"https://th.bing.com/th/id/OIP.e50FmnhjA_7V7qco940hoQHaFF?w=1200&h=825&rs=1&pid=ImgDetMain\",\n          gcontent: \"优质材料，经典黑色，耐用防水。\",\n          gcount: 100,\n          glevel: 1\n        },\n        {\n          id: 2,\n          title: \"经世楼\",\n          gimage: \"https://th.bing.com/th/id/OIP.uGeEptel9JcfpSkyhte7iAHaE8?w=1200&h=800&rs=1&pid=ImgDetMain\",\n          gcontent: \"鲜艳的颜色，适合儿童使用。\",\n          gcount: 50,\n          glevel: 2\n        },\n        {\n          id: 3,\n          title: \"文理大楼\",\n          gimage: \"https://th.bing.com/th/id/OIP.p_NRM0_x1zsMJDiXlTXtqQHaE8?w=1200&h=800&rs=1&pid=ImgDetMain\",\n          gcontent: \"轻便折叠，随身携带。\",\n          gcount: 200,\n          glevel: 3\n        }\n      ],\n      labels: [\"全部\"],\n      names: [\"all\"],\n      currentPage: 1,\n      pageLimits: [10],\n      pageSize: 10,\n      itemTotal: 10,\n      searchName: \"\",\n      loginFlag: false,\n      token: null,\n      currGoods: {},\n      currUser: null,\n      uCount :{},\n    };\n  },\n  methods: {\n    toLogin() {\n      this.$router.push({ path: \"/Login\" });\n    },\n    toRegister() {\n      this.$router.push({ path: \"/Register\" });\n    },\n    async getGoodsCount(page, limit) {\n      try {\n        const response = await this.axios.get('http://localhost:8123/api/goods/count');\n        const goodsData = response.data; //\n\n        this.goods = goodsData.goods; // 更新 goods 数据\n        this.itemTotal = goodsData.length; // 更新总数量\n        this.carouselGoods = goodsData.slice(0, 3); // 更新轮播图数据\n        this.uCount=goodsData.ulevelCount;\n\n\n      } catch (error) {\n        console.error('Failed to fetch goods data:', error);\n        this.$message.error('无法获取商品数据');\n      }\n    },\n    getGoods(page, limit) {\n      // Simulating a backend call with the mock data\n      console.log(\"Fetching goods for page\", page, \"with limit\", limit);\n      // For simplicity, here we are not making an actual axios request\n      // You can implement the logic for fetching data from backend here\n      this.itemTotal = this.goods.length;\n      this.carouselGoods = this.goods.slice(0, 4);\n    },\n    handleSizeChange(limit) {\n      this.limit = limit;\n      this.currentPage = 1;\n      this.getGoods(this.currentPage, this.limit);\n    },\n    handleCurrentChange(val) {\n      this.currentPage = val;\n      this.getGoods(this.currentPage, this.limit);\n    },\n    toCarousel() {},\n    onBuy(res) {\n      console.log(res);\n      if (!this.token) {\n        this.$message({\n          message: \"请先登录\",\n          type: \"error\",\n        });\n      } else {\n        this.currGoods = res;\n        this.$confirm(\"确认租借后将生成订单信息\", \"确认信息\", {\n          distinguishCancelAndClose: true,\n          confirmButtonText: \"确认\",\n          cancelButtonText: \"取消\",\n        })\n            .then(() => {\n              this.buyGoods();\n            })\n            .catch((action) => {\n              this.$message({\n                type: \"warning\",\n                message: \"已放弃租借\",\n              });\n            });\n      }\n    },\n    toLoginout() {\n      console.log(this.token, \"<<<<<token\");\n      this.axios\n          .post(\"http://localhost:8123/api/user/loginout\", null, {\n            params: {\n              token: this.token,\n            },\n          })\n          .then((resp) => {\n            console.log(resp);\n            localStorage.removeItem(\"token\");\n            this.loginFlag = false;\n            this.token = null;\n            this.$message({\n              message: \"退出成功\",\n              type: \"success\",\n            });\n          })\n          .catch((error) => {\n            console.log(error);\n          });\n    },\n    toHome() {\n      this.$router.push({ path: \"/Home\" });\n    },\n    buyGoods() {\n      this.axios.defaults.headers.post[\"Content-Type\"] =\n          \"application/x-www-form-urlencoded\";\n      const params = new URLSearchParams();\n      params.append(\"token\", this.token);\n      params.append(\"dAmount\", this.currGoods.gprice);\n      params.append(\"dCount\", 1);\n      params.append(\"sId\", this.currGoods.uid);\n      params.append(\"gId\", this.currGoods.gid);\n      params.append(\"bId\", this.currUser.uid);\n\n      this.axios\n          .post(\"http://localhost:8123/api/order/add\", params)\n          .then((resp) => {\n            console.log(resp);\n            this.getGoods();\n            this.$message({\n              type: \"success\",\n              message: \"订单生成成功，请前往个人中心完成支付  \",\n            });\n            this.currGoods = {};\n          })\n          .catch((error) => {\n            console.log(error);\n          });\n      this.currGoods = {};\n    },\n  },\n\n  created() {\n    this.getGoods(1, 10);\n    let token = localStorage.getItem(\"token\");\n    console.log(token);\n    if (token === null) {\n      this.loginFlag = false;\n      this.token = null;\n      this.currUser = null;\n    } else {\n      this.token = token;\n      this.loginFlag = true;\n      this.currUser = JSON.parse(localStorage.getItem(\"currUser\"));\n    }\n  },\n};\n</script>\n\n<style>\n.block {\n  margin: 5px 80px;\n}\n\n.el-carousel__item h3 {\n  color: #475669;\n  font-size: 14px;\n  opacity: 0.75;\n  line-height: 150px;\n  margin: 0;\n}\n\n.el-carousel__item:nth-child(2n) {\n  background-color: #99a9bf;\n}\n\n.el-carousel__item:nth-child(2n + 1) {\n  background-color: #d3dce6;\n\n}\n\n.tab {\n  margin: 50px;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}